<html><head><title>Shironeko: Choosing style</title><meta charset="utf-8" /><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" /><meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="author" content="Oleg Pyzhcov" /><meta name="description" content="shironeko" /><meta name="og:image" content="/shironeko/img/poster.png" /><meta name="image" property="og:image" content="/shironeko/img/poster.png" /><meta name="og:title" content="Shironeko: Choosing style" /><meta name="title" property="og:title" content="Shironeko: Choosing style" /><meta name="og:site_name" content="Shironeko" /><meta name="og:url" content="http://github.com/oleg-py/shironeko" /><meta name="og:type" content="website" /><meta name="og:description" content="shironeko" /><link rel="icon" type="image/png" href="/shironeko/img/favicon.png" /><meta name="twitter:title" content="Shironeko: Choosing style" /><meta name="twitter:image" content="/shironeko/img/poster.png" /><meta name="twitter:description" content="shironeko" /><meta name="twitter:card" content="summary_large_image" /><link rel="icon" type="image/png" sizes="16x16" href="/shironeko/img/favicon16x16.png" /><link rel="icon" type="image/png" sizes="24x24" href="/shironeko/img/favicon24x24.png" /><link rel="icon" type="image/png" sizes="32x32" href="/shironeko/img/favicon32x32.png" /><link rel="icon" type="image/png" sizes="48x48" href="/shironeko/img/favicon48x48.png" /><link rel="icon" type="image/png" sizes="57x57" href="/shironeko/img/favicon57x57.png" /><link rel="icon" type="image/png" sizes="60x60" href="/shironeko/img/favicon60x60.png" /><link rel="icon" type="image/png" sizes="64x64" href="/shironeko/img/favicon64x64.png" /><link rel="icon" type="image/png" sizes="70x70" href="/shironeko/img/favicon70x70.png" /><link rel="icon" type="image/png" sizes="72x72" href="/shironeko/img/favicon72x72.png" /><link rel="icon" type="image/png" sizes="76x76" href="/shironeko/img/favicon76x76.png" /><link rel="icon" type="image/png" sizes="96x96" href="/shironeko/img/favicon96x96.png" /><link rel="icon" type="image/png" sizes="114x114" href="/shironeko/img/favicon114x114.png" /><link rel="icon" type="image/png" sizes="120x120" href="/shironeko/img/favicon120x120.png" /><link rel="icon" type="image/png" sizes="128x128" href="/shironeko/img/favicon128x128.png" /><link rel="icon" type="image/png" sizes="144x144" href="/shironeko/img/favicon144x144.png" /><link rel="icon" type="image/png" sizes="150x150" href="/shironeko/img/favicon150x150.png" /><link rel="icon" type="image/png" sizes="152x152" href="/shironeko/img/favicon152x152.png" /><link rel="icon" type="image/png" sizes="196x196" href="/shironeko/img/favicon196x196.png" /><link rel="icon" type="image/png" sizes="310x310" href="/shironeko/img/favicon310x310.png" /><link rel="icon" type="image/png" sizes="310x150" href="/shironeko/img/favicon310x150.png" /><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" /><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" /><link rel="stylesheet" href="/shironeko/highlight/styles/default.css" /><link rel="stylesheet" href="/shironeko/css/style.css" /><link rel="stylesheet" href="/shironeko/css/palette.css" /><link rel="stylesheet" href="/shironeko/css/codemirror.css" /></head><body class="docs"><div id="wrapper"><div id="sidebar-wrapper"><ul id="sidebar" class="sidebar-nav"><li class="sidebar-brand"><a href="/shironeko/" class="brand"><div class="brand-wrapper"><span>Shironeko</span></div></a></li> <li><a href="/shironeko/01_Quickstart.html" class="">Quickstart</a></li> <li><a href="/shironeko/02_Basic concepts.html" class="">Basic concepts</a></li> <li><a href="/shironeko/03_Choosing style.html" class=" active ">Choosing style</a></li> <li><a href="/shironeko/04_Utilities.html" class="">Misc. utilities</a></li></ul></div><div id="page-content-wrapper"><div class="nav"><div class="container-fluid"><div class="row"><div class="col-lg-12"><div class="action-menu pull-left clearfix"><a href="#menu-toggle" id="menu-toggle"><i class="fa fa-bars" aria-hidden="true"></i></a></div><ul class="pull-right"><li id="gh-eyes-item" class="hidden-xs"><a href="https://github.com/oleg-py/shironeko"><i class="fa fa-eye"></i><span>WATCH<span id="eyes" class="label label-default">--</span></span></a></li><li id="gh-stars-item" class="hidden-xs"><a href="https://github.com/oleg-py/shironeko"><i class="fa fa-star-o"></i><span>STARS<span id="stars" class="label label-default">--</span></span></a></li><li><a href="#" onclick="shareSiteTwitter('Shironeko shironeko');"><i class="fa fa-twitter"></i></a></li><li><a href="#" onclick="shareSiteFacebook('Shironeko shironeko');"><i class="fa fa-facebook"></i></a></li><li><a href="#" onclick="shareSiteGoogle();"><i class="fa fa-google-plus"></i></a></li></ul></div></div></div></div><div id="content" data-github-owner="oleg-py" data-github-repo="shironeko"><div class="content-wrapper"><section><p>Shironeko is a very unopinionated library, providing you
with multiple options for building your application. In particular,
you can use tagless style, where state container is parameterized with
an effect type, or direct style with a concrete effect type. You can
also use event-sourcing and hide direct state manipulation, or expose
state cells directly in algebra. You can put actions into state container
itself, or write them outside in a separate <code class="highlighter-rouge">class</code>/<code class="highlighter-rouge">object</code>, make
some parts private and expose only minimum needed to render the app. You
can also use multiple algebras for different state parts.</p>

<p>If you are not sure where to even begin, I’ll make the choices for you:</p>
<ul>
  <li>If you’re using cats-effect IO, go with tagless style. If you’re using
monix or ZIO, go with direct style.</li>
  <li>Start with one algebra and one connector.</li>
  <li>Start with direct state manipulation and exposed state cells.
Avoid event sourcing as much as possible. Don’t encapsulate anything,
but put related state pieces into a single cell as a case class.</li>
  <li>Put all actions into separate objects/classes. Don’t write them inline
and don’t put them together with app state.</li>
</ul>

<h2 id="tagless-or-non-tagless">Tagless or non-tagless</h2>

<p>Consider tagless style if you’re familiar with technique,
want to exercise more discipline or use <code class="highlighter-rouge">cats.effect.IO</code>,
there is little benefit to this concrete type.</p>

<p>Use direct style if you’re using capabilities of a more powerful effect
type. For example, monix <code class="highlighter-rouge">Task</code> has <code class="highlighter-rouge">Parallel</code>, <code class="highlighter-rouge">Timer</code> and
<code class="highlighter-rouge">ContextShift</code> always available in scope, allowing you to <code class="highlighter-rouge">.debounce</code>
any <code class="highlighter-rouge">Stream</code> and use <code class="highlighter-rouge">parMapN</code>-like operators directly.</p>

<p>The connector definition is not different, and you still get a Concurrent
instance and an implicit of your choice propagated - however, in
direct style, the implicit must not be a type constructor.</p>

<p>There are also no <code class="highlighter-rouge">ContainerF</code> base classes, as they are not necessary.</p>

<p>Finally, there is no restriction on <code class="highlighter-rouge">exec</code>/<code class="highlighter-rouge">toCallback</code> method usage.
And, since you know which effect you’re using, you might use
its methods (like <code class="highlighter-rouge">unsafeRunAsyncAndForget</code> on IO) directly if the type
allows it.</p>

<p>Other than that, the API/usage is very similar in two styles:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Algebras
</span><span class="k">class</span> <span class="nc">AlgebraF</span><span class="o">[</span><span class="kt">F</span><span class="o">[</span><span class="k">_</span><span class="o">]](</span><span class="n">dsl</span><span class="k">:</span> <span class="kt">StoreDSL</span><span class="o">[</span><span class="kt">F</span><span class="o">])</span> <span class="o">{</span>
  <span class="k">import</span> <span class="nn">dsl._</span>
  <span class="k">val</span> <span class="n">state</span> <span class="k">=</span> <span class="n">cell</span><span class="o">(</span><span class="mi">42</span><span class="o">)</span>
  <span class="k">val</span> <span class="n">log</span>   <span class="k">=</span> <span class="n">cell</span><span class="o">(</span><span class="nc">List</span><span class="o">.</span><span class="n">empty</span><span class="o">[</span><span class="kt">String</span><span class="o">])</span>
<span class="o">}</span>

<span class="k">class</span> <span class="nc">Algebra</span><span class="o">(</span><span class="n">dsl</span><span class="k">:</span> <span class="kt">StoreDSL</span><span class="o">[</span><span class="kt">Task</span><span class="o">])</span> <span class="o">{</span>
  <span class="k">import</span> <span class="nn">dsl._</span>
  <span class="k">val</span> <span class="n">state</span> <span class="k">=</span> <span class="n">cell</span><span class="o">(</span><span class="mi">42</span><span class="o">)</span>
  <span class="k">val</span> <span class="n">log</span>   <span class="k">=</span> <span class="n">cell</span><span class="o">(</span><span class="nc">List</span><span class="o">.</span><span class="n">empty</span><span class="o">[</span><span class="kt">String</span><span class="o">])</span>
<span class="o">}</span>

<span class="c1">// Connectors
</span><span class="k">object</span> <span class="nc">Connector1</span> <span class="k">extends</span> <span class="nc">TaglessConnector</span><span class="o">[</span><span class="kt">AlgebraF</span><span class="o">]</span>
<span class="k">object</span> <span class="nc">Connector2</span> <span class="k">extends</span> <span class="nc">DirectConnector</span><span class="o">[</span><span class="kt">Task</span>, <span class="kt">Algebra</span><span class="o">]</span>

<span class="c1">// Containers
</span>
<span class="k">object</span> <span class="nc">TestContainer</span> <span class="k">extends</span> <span class="nc">Connector1</span><span class="o">.</span><span class="nc">ContainerNoProps</span> <span class="o">{</span>
  <span class="k">case</span> <span class="k">class</span> <span class="nc">State</span><span class="o">(</span><span class="n">i</span><span class="k">:</span> <span class="kt">Int</span><span class="o">,</span> <span class="n">l</span><span class="k">:</span> <span class="kt">List</span><span class="o">[</span><span class="kt">String</span><span class="o">])</span>
  <span class="k">def</span> <span class="n">subscribe</span><span class="o">[</span><span class="kt">F</span><span class="o">[</span><span class="k">_</span><span class="o">]</span><span class="kt">:</span> <span class="kt">Subscribe</span><span class="o">]</span><span class="k">:</span> <span class="kt">fs2.Stream</span><span class="o">[</span><span class="kt">F</span>, <span class="kt">State</span><span class="o">]</span> <span class="k">=</span> <span class="o">{</span>
    <span class="k">val</span> <span class="n">F</span> <span class="k">=</span> <span class="n">getAlgebra</span>
    <span class="n">combine</span><span class="o">[</span><span class="kt">State</span><span class="o">].</span><span class="n">from</span><span class="o">(</span>
      <span class="n">F</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">discrete</span><span class="o">,</span>
      <span class="n">F</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">discrete</span>
    <span class="o">)</span>
  <span class="o">}</span>
  
  <span class="k">def</span> <span class="n">render</span><span class="o">[</span><span class="kt">F</span><span class="o">[</span><span class="k">_</span><span class="o">]</span><span class="kt">:</span> <span class="kt">Render</span><span class="o">](</span><span class="n">s</span><span class="k">:</span> <span class="kt">State</span><span class="o">)</span> <span class="k">=</span> 
    <span class="n">div</span><span class="o">(</span>
      <span class="n">div</span><span class="o">(</span><span class="n">state</span><span class="o">.</span><span class="n">i</span><span class="o">,</span> <span class="n">onClick</span> <span class="o">:=</span> <span class="n">toCallback</span> <span class="o">{</span> <span class="n">getAlgebra</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">update</span><span class="o">(</span><span class="s">"Clicked"</span> <span class="o">::</span> <span class="k">_</span><span class="o">)</span> <span class="o">}),</span>
      <span class="n">div</span><span class="o">(</span><span class="n">state</span><span class="o">.</span><span class="n">l</span><span class="o">.</span><span class="n">mkString</span><span class="o">(</span><span class="s">", "</span><span class="o">))</span>
    <span class="o">)</span>
<span class="o">}</span>

<span class="k">object</span> <span class="nc">TestContainer</span> <span class="k">extends</span> <span class="nc">Connector2</span><span class="o">.</span><span class="nc">ContainerNoProps</span> <span class="o">{</span>
  <span class="k">case</span> <span class="k">class</span> <span class="nc">State</span><span class="o">(</span><span class="n">i</span><span class="k">:</span> <span class="kt">Int</span><span class="o">,</span> <span class="n">l</span><span class="k">:</span> <span class="kt">List</span><span class="o">[</span><span class="kt">String</span><span class="o">])</span>
  <span class="k">def</span> <span class="n">subscribe</span><span class="k">:</span> <span class="kt">fs2.Stream</span><span class="o">[</span><span class="kt">Task</span>, <span class="kt">State</span><span class="o">]</span> <span class="k">=</span> <span class="o">{</span>
    <span class="k">val</span> <span class="n">F</span> <span class="k">=</span> <span class="n">getAlgebra</span>
    <span class="n">combine</span><span class="o">[</span><span class="kt">State</span><span class="o">].</span><span class="n">from</span><span class="o">(</span>
      <span class="n">F</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">discrete</span><span class="o">,</span>
      <span class="n">F</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">discrete</span>
    <span class="o">)</span>
  <span class="o">}</span>
  
  <span class="k">def</span> <span class="n">render</span><span class="o">(</span><span class="n">s</span><span class="k">:</span> <span class="kt">State</span><span class="o">)</span> <span class="k">=</span> 
    <span class="n">div</span><span class="o">(</span>
      <span class="n">div</span><span class="o">(</span><span class="n">state</span><span class="o">.</span><span class="n">i</span><span class="o">,</span> <span class="n">onClick</span> <span class="o">:=</span> <span class="n">toCallback</span> <span class="o">{</span> <span class="n">getAlgebra</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">update</span><span class="o">(</span><span class="s">"Clicked"</span> <span class="o">::</span> <span class="k">_</span><span class="o">)</span> <span class="o">}),</span>
      <span class="n">div</span><span class="o">(</span><span class="n">state</span><span class="o">.</span><span class="n">l</span><span class="o">.</span><span class="n">mkString</span><span class="o">(</span><span class="s">", "</span><span class="o">))</span>
    <span class="o">)</span>
<span class="o">}</span>
</code></pre></div></div>

<h2 id="event-sourcing-vs-direct-modification">Event sourcing vs direct modification</h2>

<p>I recommend not using event sourcing as a method for single state
changes. You can always change multiple values in one action:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="n">updateCounter</span><span class="o">[</span><span class="kt">F</span><span class="o">[</span><span class="k">_</span><span class="o">]</span><span class="kt">:</span> <span class="kt">Monad</span><span class="o">](</span><span class="k">implicit</span> <span class="n">F</span><span class="k">:</span> <span class="kt">Algebra</span><span class="o">[</span><span class="kt">F</span><span class="o">])</span> <span class="k">=</span>
  <span class="n">F</span><span class="o">.</span><span class="n">counter</span><span class="o">.</span><span class="n">update</span><span class="o">(</span><span class="k">_</span> <span class="o">+</span> <span class="mi">1</span><span class="o">)</span> <span class="o">&gt;&gt;</span> <span class="n">F</span><span class="o">.</span><span class="n">updated</span><span class="o">.</span><span class="n">set</span><span class="o">(</span><span class="kc">true</span><span class="o">)</span>
</code></pre></div></div>

<p>The power of event streams comes from its async control flow features,
allowing for fairly complex, but very <em>manual</em> interaction between
multiple semantically independent actions.</p>

<p>Consider this simple example:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Regular action
</span><span class="k">val</span> <span class="n">renderer</span><span class="k">:</span> <span class="kt">F</span><span class="o">[</span><span class="kt">Unit</span><span class="o">]</span> <span class="k">=</span> <span class="k">for</span> <span class="o">{</span>
  <span class="k">_</span>    <span class="k">&lt;-</span> <span class="n">F</span><span class="o">.</span><span class="n">message</span><span class="o">.</span><span class="n">set</span><span class="o">(</span><span class="n">s</span><span class="s">"Starting a data request"</span><span class="o">)</span>
  <span class="n">id</span>   <span class="k">&lt;-</span> <span class="n">F</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">modify</span><span class="o">(</span><span class="n">x</span> <span class="k">=&gt;</span> <span class="o">(</span><span class="n">x</span> <span class="o">+</span> <span class="mi">1</span><span class="o">,</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">1</span><span class="o">))</span>
  <span class="k">_</span>    <span class="k">&lt;-</span> <span class="n">requestor</span><span class="o">(</span><span class="n">id</span><span class="o">).</span><span class="n">start</span>
  <span class="k">_</span>    <span class="k">&lt;-</span> <span class="n">F</span><span class="o">.</span><span class="n">events</span><span class="o">.</span><span class="n">await1</span> <span class="o">{</span> <span class="k">case</span> <span class="nc">Accepted</span><span class="o">(</span><span class="n">`id`</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="o">()</span> <span class="o">}</span>
  <span class="k">_</span>    <span class="k">&lt;-</span> <span class="n">F</span><span class="o">.</span><span class="n">message</span><span class="o">.</span><span class="n">set</span><span class="o">(</span><span class="n">s</span><span class="s">"Request $id was accepted"</span><span class="o">)</span>
  <span class="n">data</span> <span class="k">&lt;-</span> <span class="n">F</span><span class="o">.</span><span class="n">events</span><span class="o">.</span><span class="n">await1</span> <span class="o">{</span> <span class="k">case</span> <span class="nc">Completed</span><span class="o">(</span><span class="n">`id`</span><span class="o">,</span> <span class="n">data</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="n">data</span> <span class="o">}</span>
  <span class="k">_</span>    <span class="k">&lt;-</span> <span class="n">F</span><span class="o">.</span><span class="n">message</span><span class="o">.</span><span class="n">set</span><span class="o">(</span><span class="n">s</span><span class="s">"Request $id completed, god $data"</span><span class="o">)</span>
<span class="o">}</span> <span class="k">yield</span> <span class="o">()</span>

<span class="k">def</span> <span class="n">requestor</span><span class="o">(</span><span class="n">id</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span><span class="k">:</span> <span class="kt">F</span><span class="o">[</span><span class="kt">Unit</span><span class="o">]</span> <span class="k">=</span> <span class="k">for</span> <span class="o">{</span>
  <span class="k">_</span>    <span class="k">&lt;-</span> <span class="n">backend</span><span class="o">.</span><span class="n">put</span><span class="o">(</span><span class="n">s</span><span class="s">"/request/$id"</span><span class="o">)</span>
  <span class="k">_</span>    <span class="k">&lt;-</span> <span class="n">F</span><span class="o">.</span><span class="n">events</span><span class="o">.</span><span class="n">emit1</span><span class="o">(</span><span class="nc">Accepted</span><span class="o">(</span><span class="n">`id`</span><span class="o">))</span>
  <span class="n">data</span> <span class="k">&lt;-</span> <span class="n">backend</span><span class="o">.</span><span class="n">get</span><span class="o">(</span><span class="n">s</span><span class="s">"/request/$id/result"</span><span class="o">)</span>
  <span class="k">_</span>    <span class="k">&lt;-</span> <span class="n">F</span><span class="o">.</span><span class="n">events</span><span class="o">.</span><span class="n">emit1</span><span class="o">(</span><span class="nc">Completed</span><span class="o">(</span><span class="n">id</span><span class="o">,</span> <span class="n">data</span><span class="o">))</span>
<span class="o">}</span> <span class="k">yield</span> <span class="o">()</span> 
  

<span class="c1">// Set this one up in the `main`
</span><span class="k">val</span> <span class="n">logger</span> <span class="k">=</span> <span class="n">F</span><span class="o">.</span><span class="n">events</span><span class="o">.</span><span class="n">onNextDo</span> <span class="o">{</span>
  <span class="k">case</span> <span class="nc">Completed</span><span class="o">(</span><span class="n">id</span><span class="o">,</span> <span class="n">data</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="n">F</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">update</span><span class="o">(</span><span class="n">s</span><span class="s">"Request $id: $data"</span> <span class="o">+:</span> <span class="k">_</span><span class="o">)</span>
  <span class="k">case</span> <span class="k">_</span> <span class="k">=&gt;</span> <span class="o">().</span><span class="n">pure</span><span class="o">[</span><span class="kt">F</span><span class="o">]</span>
<span class="o">}</span>
</code></pre></div></div>

<p>While powerful and convenient, it lacks proper error handling, and an error
in <code class="highlighter-rouge">requestor</code> will cause the continuation of <code class="highlighter-rouge">renderer</code> to hang forever.
Using return values (F[A]) where possible could solve that:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">val</span> <span class="n">renderer</span><span class="k">:</span> <span class="kt">F</span><span class="o">[</span><span class="kt">Unit</span><span class="o">]</span> <span class="k">=</span> <span class="k">for</span> <span class="o">{</span>
  <span class="k">_</span>    <span class="k">&lt;-</span> <span class="n">F</span><span class="o">.</span><span class="n">message</span><span class="o">.</span><span class="n">set</span><span class="o">(</span><span class="n">s</span><span class="s">"Starting a data request"</span><span class="o">)</span>
  <span class="n">id</span>   <span class="k">&lt;-</span> <span class="n">F</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">modify</span><span class="o">(</span><span class="n">x</span> <span class="k">=&gt;</span> <span class="o">(</span><span class="n">x</span> <span class="o">+</span> <span class="mi">1</span><span class="o">,</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">1</span><span class="o">))</span>
  <span class="n">data</span> <span class="k">&lt;-</span> <span class="n">requestor</span><span class="o">(</span><span class="n">id</span><span class="o">)</span>
  <span class="k">_</span>    <span class="k">&lt;-</span> <span class="n">F</span><span class="o">.</span><span class="n">message</span><span class="o">.</span><span class="n">set</span><span class="o">(</span><span class="n">s</span><span class="s">"Request $id completed, god $data"</span><span class="o">)</span>
<span class="o">}</span> <span class="k">yield</span> <span class="o">()</span>

<span class="k">def</span> <span class="n">requestor</span><span class="o">(</span><span class="n">id</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span><span class="k">:</span> <span class="kt">F</span><span class="o">[</span><span class="kt">Data</span><span class="o">]</span> <span class="k">=</span> <span class="k">for</span> <span class="o">{</span>
  <span class="k">_</span>    <span class="k">&lt;-</span> <span class="n">backend</span><span class="o">.</span><span class="n">put</span><span class="o">(</span><span class="n">s</span><span class="s">"/request/$id"</span><span class="o">)</span>
  <span class="k">_</span>    <span class="k">&lt;-</span> <span class="n">F</span><span class="o">.</span><span class="n">message</span><span class="o">.</span><span class="n">set</span><span class="o">(</span><span class="n">s</span><span class="s">"Request $id was accepted"</span><span class="o">)</span>
  <span class="n">data</span> <span class="k">&lt;-</span> <span class="n">backend</span><span class="o">.</span><span class="n">get</span><span class="o">(</span><span class="n">s</span><span class="s">"/request/$id/result"</span><span class="o">)</span>
  <span class="k">_</span>    <span class="k">&lt;-</span> <span class="n">F</span><span class="o">.</span><span class="n">events</span><span class="o">.</span><span class="n">emit1</span> <span class="o">{</span> <span class="nc">Completed</span><span class="o">(</span><span class="n">id</span><span class="o">,</span> <span class="n">data</span><span class="o">)</span> <span class="o">}</span>
<span class="o">}</span> <span class="k">yield</span> <span class="n">data</span>
  

<span class="c1">// This one is okay, it's not waiting forever.
</span><span class="k">val</span> <span class="n">logger</span> <span class="k">=</span> <span class="n">F</span><span class="o">.</span><span class="n">events</span><span class="o">.</span><span class="n">onNextDo</span> <span class="o">{</span>
  <span class="k">case</span> <span class="nc">Completed</span><span class="o">(</span><span class="n">id</span><span class="o">,</span> <span class="n">data</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="n">F</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">update</span><span class="o">(</span><span class="n">s</span><span class="s">"Request $id: $data"</span> <span class="o">+:</span> <span class="k">_</span><span class="o">)</span>
  <span class="k">case</span> <span class="k">_</span> <span class="k">=&gt;</span> <span class="o">().</span><span class="n">pure</span><span class="o">[</span><span class="kt">F</span><span class="o">]</span>
<span class="o">}</span>
</code></pre></div></div>

</section></div></div></div></div><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script><script src="/shironeko/highlight/highlight.pack.js"></script><script>hljs.configure({languages:['scala','java','bash']});
hljs.initHighlighting();
              </script><script src="/shironeko/js/main.js"></script></body></html>